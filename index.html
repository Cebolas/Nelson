<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miss√£o Bit</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      overflow: hidden;
    }

    #game-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    canvas {
      image-rendering: pixelated;
      border: 4px solid #fff;
      background-color: #222;
    }

    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border: 2px solid #fff;
      font-size: 16px;
      border-radius: 8px;
      display: none;
      font-family: 'Courier New', monospace;
    }

    #hud span {
      display: inline-block;
      min-width: 40px;
    }

    #menu {
      text-align: center;
      background: #000;
      border: 4px solid #fff;
      padding: 20px;
      max-width: 500px;
      box-shadow: 0 0 0 8px #000;
    }

    .title {
      font-size: 32px;
      margin-bottom: 20px;
      text-shadow: 3px 3px 0 #fff;
      letter-spacing: 2px;
      font-family: 'Courier New', monospace;
    }

    .description {
      margin-bottom: 30px;
      line-height: 1.5;
      font-family: 'Courier New', monospace;
    }

    .menu-btn {
      margin: 10px auto;
      padding: 12px 24px;
      font-size: 18px;
      background-color: #000;
      border: 2px solid #fff;
      color: white;
      cursor: pointer;
      display: block;
      width: 80%;
      transition: all 0.2s;
      font-family: 'Courier New', monospace;
    }

    .menu-btn:hover {
      background-color: #fff;
      color: #000;
    }

    #cutscene {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border: 2px solid white;
      display: none;
      text-align: center;
      max-width: 300px;
      border-radius: 10px;
      z-index: 10;
      font-family: 'Courier New', monospace;
    }

    #timer {
      margin-top: 5px;
    }

    .pixel-art {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    .emoji-pixel {
      font-size: 16px;
      image-rendering: pixelated;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1 class="title">MISS√ÉO BIT</h1>
    <p class="description">Voc√™ √© o Bit, uma unidade digital determinada a evoluir at√© se tornar um poderoso Terabyte!<br><br>
    Embarque nessa aventura cibern√©tica, aprenda sobre inform√°tica e derrote o v√≠rus final!</p>
    <button id="modoHistoriaBtn" class="menu-btn">MODO HIST√ìRIA</button>
    <button id="modoInfinitoBtn" class="menu-btn">MODO DESAFIO INFINITO</button>
  </div>

  <div id="hud">
    <span class="emoji-pixel">‚ù§Ô∏è</span> Vidas: <span id="vidas">3</span><br />
    <span class="emoji-pixel">üßÆ</span> Pontos: <span id="score">0</span><br />
    <span class="emoji-pixel">üöÄ</span> Fase: <span id="fase">1</span><br />
    <span class="emoji-pixel">‚è±Ô∏è</span> Tempo: <span id="timer">35</span>s
  </div>

  <div id="cutscene"></div>
  <div id="game-container">
    <canvas id="game" width="480" height="320" style="display: none;"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const menu = document.getElementById("menu");
    const hud = document.getElementById("hud");
    const timerDisplay = document.getElementById("timer");
    const scoreDisplay = document.getElementById("score");
    const faseDisplay = document.getElementById("fase");
    const vidasDisplay = document.getElementById("vidas");
    const cutsceneBox = document.getElementById("cutscene");
    const gameContainer = document.getElementById("game-container");

    const tileSize = 16;
    let score = 0;
    let faseAtual = 0;
    let tempo = 35; // Aumentado para 35 segundos
    let vidas = 3;
    let cronometro;
    let inimigos = [];
    let pontosRestantes = 0;
    let modoDesafio = false;
    let recorde = localStorage.getItem("recorde") || 0;
    let jogoPausado = false;

    const fases = [];
    const conceitos = [];

    function mostrarCutscene(texto, callback) {
      cutsceneBox.innerText = texto;
      cutsceneBox.style.display = "block";
      jogoPausado = true;
      clearInterval(cronometro);
      
      setTimeout(() => {
        cutsceneBox.style.display = "none";
        jogoPausado = false;
        // Reinicia o cron√¥metro
        cronometro = setInterval(atualizarTempo, 1000);
        if (callback) callback();
      }, 4000);
    }

    function atualizarTempo() {
      if (jogoPausado) return;
      
      tempo--;
      timerDisplay.textContent = tempo;
      moverInimigos();
      if (tempo <= 0) perderVida("‚è±Ô∏è Tempo esgotado!");
    }

    function mostrarConceito() {
      const conceito = conceitos[faseAtual % conceitos.length];
      jogoPausado = true;
      clearInterval(cronometro);
      
      ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
      ctx.fillRect(canvas.width/2 - 150, canvas.height/2 - 30, 300, 60);
      ctx.fillStyle = "#fff";
      ctx.font = "14px 'Courier New'";
      ctx.textAlign = "center";
      
      const palavras = conceito.split(" ");
      let linha1 = "";
      let linha2 = "";
      
      for (const palavra of palavras) {
        if (linha1.length + palavra.length < 30) {
          linha1 += palavra + " ";
        } else {
          linha2 += palavra + " ";
        }
      }
      
      ctx.fillText(linha1.trim(), canvas.width/2, canvas.height/2 - 5);
      if (linha2) {
        ctx.fillText(linha2.trim(), canvas.width/2, canvas.height/2 + 15);
      }
      
      setTimeout(() => {
        jogoPausado = false;
        desenharMapa();
        // Reinicia o cron√¥metro
        cronometro = setInterval(atualizarTempo, 1000);
      }, 3000);
    }

    function gerarFaseAleatoria() {
      const linha = "#######################";
      const mapa = [linha];
      
      for (let y = 1; y < 18; y++) {
        let l = "#";
        for (let x = 1; x < 22; x++) {
          if ((x <= 3 && y <= 3)) {
            l += " ";
          } else {
            l += Math.random() < 0.08 ? "#" : " ";
          }
        }
        l += "#";
        mapa.push(l);
      }
      mapa.push(linha);
      
      let mapArray = mapa.map(row => row.split(""));
      mapArray[1][1] = "@";
      
      for (let j = 0; j < 8; j++) {
        const rx = 2 + Math.floor(Math.random() * 20);
        const ry = 2 + Math.floor(Math.random() * 16);
        if (mapArray[ry][rx] === " ") mapArray[ry][rx] = ".";
      }
      
      for (let j = 0; j < 3; j++) {
        const rx = 2 + Math.floor(Math.random() * 20);
        const ry = 2 + Math.floor(Math.random() * 16);
        if (mapArray[ry][rx] === " ") mapArray[ry][rx] = "V";
      }
      
      return mapArray.map(row => row.join(""));
    }

    for (let i = 0; i < 50; i++) {
      let faseValida = false;
      while (!faseValida) {
        const fase = gerarFaseAleatoria();
        if (verificarCaminhoLivre(fase)) {
          fases.push(fase);
          faseValida = true;
        }
      }
    }

    function verificarCaminhoLivre(fase) {
      const mapa = fase.map(linha => linha.split(""));
      const visitados = Array(mapa.length).fill().map(() => Array(mapa[0].length).fill(false));
      const fila = [{x: 1, y: 1}];
      let pontosAcessiveis = 0;
      
      while (fila.length > 0) {
        const atual = fila.shift();
        if (visitados[atual.y][atual.x]) continue;
        
        visitados[atual.y][atual.x] = true;
        
        if (mapa[atual.y][atual.x] === ".") pontosAcessiveis++;
        
        const direcoes = [
          {dx: 1, dy: 0}, {dx: -1, dy: 0}, 
          {dx: 0, dy: 1}, {dx: 0, dy: -1}
        ];
        
        for (const dir of direcoes) {
          const nx = atual.x + dir.dx;
          const ny = atual.y + dir.dy;
          
          if (nx >= 0 && nx < mapa[0].length && 
              ny >= 0 && ny < mapa.length && 
              mapa[ny][nx] !== "#" && !visitados[ny][nx]) {
            fila.push({x: nx, y: ny});
          }
        }
      }
      
      const totalPontos = fase.join("").split(".").length - 1;
      return pontosAcessiveis >= Math.ceil(totalPontos * 0.5);
    }

    const conceitosBase = [
      "Bit √© a menor unidade de informa√ß√£o.",
      "Byte √© um grupo de 8 bits.",
      "Hardware √© a parte f√≠sica do computador.",
      "Software √© o que faz o hardware funcionar.",
      "O processador executa instru√ß√µes.",
      "Mem√≥ria RAM √© onde os dados s√£o armazenados temporariamente.",
      "Sistema Operacional gerencia os recursos do computador.",
      "Rede conecta computadores para compartilhar dados."
    ];
    conceitos.push(...conceitosBase);

    let mapa = [];
    let player = { x: 0, y: 0 };

    function carregarFase(n) {
      if (modoDesafio && n >= fases.length) {
        let faseValida = false;
        while (!faseValida) {
          const fase = gerarFaseAleatoria();
          if (verificarCaminhoLivre(fase)) {
            fases.push(fase);
            faseValida = true;
          }
        }
      }
      
      mapa = fases[n].map(linha => linha.split(""));
      inimigos = [];
      pontosRestantes = 0;
      
      for (let y = 0; y < mapa.length; y++) {
        for (let x = 0; x < mapa[y].length; x++) {
          if (mapa[y][x] === "@") {
            player.x = x;
            player.y = y;
            mapa[y][x] = " ";
          }
          if (mapa[y][x] === ".") pontosRestantes++;
          if (mapa[y][x] === "V") inimigos.push({ x, y, dx: Math.random() > 0.5 ? 1 : -1 });
        }
      }
      
      tempo = 35; // Definido para 35 segundos
      timerDisplay.textContent = tempo;
      faseDisplay.textContent = n + 1;
      vidasDisplay.textContent = vidas;
      
      clearInterval(cronometro);
      cronometro = setInterval(atualizarTempo, 1000);
      
      desenharMapa();
      
      // Mostra conceito a cada 3 n√≠veis
      if ((n + 1) % 3 === 0) {
        setTimeout(mostrarConceito, 500);
      }
    }

    function desenharMapa() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Fundo
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Desenha o mapa
      for (let y = 0; y < mapa.length; y++) {
        for (let x = 0; x < mapa[y].length; x++) {
          // Paredes (branco)
          if (mapa[y][x] === "#") {
            ctx.fillStyle = "#fff";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          } 
          // Pontos (amarelos e maiores)
          else if (mapa[y][x] === ".") {
            ctx.fillStyle = "#ffff00";
            ctx.beginPath();
            ctx.arc(
              x * tileSize + tileSize/2, 
              y * tileSize + tileSize/2, 
              tileSize/3, 0, Math.PI * 2
            );
            ctx.fill();
          } 
          // Portal (verde)
          else if (mapa[y][x] === "X") {
            ctx.fillStyle = "#00ff00";
            ctx.beginPath();
            ctx.arc(
              x * tileSize + tileSize/2, 
              y * tileSize + tileSize/2, 
              tileSize/2, 0, Math.PI * 2
            );
            ctx.fill();
          } 
          // Inimigos (vermelhos - apenas os m√≥veis)
          else if (mapa[y][x] === "V") {
            ctx.fillStyle = "#ff0000";
            ctx.beginPath();
            ctx.moveTo(x * tileSize + tileSize/2, y * tileSize);
            ctx.lineTo(x * tileSize + tileSize, y * tileSize + tileSize);
            ctx.lineTo(x * tileSize, y * tileSize + tileSize);
            ctx.closePath();
            ctx.fill();
          }
        }
      }
      
      // Desenha o jogador (branco)
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(
        player.x * tileSize + tileSize/4, 
        player.y * tileSize + tileSize/4, 
        tileSize/2, tileSize/2
      );
    }

    function mover(dx, dy) {
      if (jogoPausado) return;
      
      const nx = player.x + dx;
      const ny = player.y + dy;
      
      if (nx < 0 || nx >= mapa[0].length || ny < 0 || ny >= mapa.length) {
        return;
      }
      
      const destino = mapa[ny][nx];
      
      if (destino !== "#") {
        for (const inimigo of inimigos) {
          if (inimigo.x === nx && inimigo.y === ny) {
            perderVida("‚ò†Ô∏è Voc√™ foi atingido por um v√≠rus!");
            return;
          }
        }
        
        player.x = nx;
        player.y = ny;
        
        if (destino === ".") {
          score++;
          pontosRestantes--;
          mapa[ny][nx] = " ";
          scoreDisplay.textContent = score;
          
          if (pontosRestantes === 0) {
            mapa[mapa.length - 2][mapa[0].length - 2] = "X";
          }
        }
        
        if (destino === "X") {
          if ((faseAtual + 1) % 10 === 0) {
            mostrarCutscene("‚úÖ Checkpoint salvo!");
          }
          if ([10, 20, 30, 40, 50].includes(faseAtual + 1)) {
            mostrarCutscene("üîÑ Bit evoluiu para o pr√≥ximo n√≠vel!");
          }
          faseAtual++;
          carregarFase(faseAtual);
        }
        
        desenharMapa();
      }
    }

    function moverInimigos() {
      if (jogoPausado) return;
      
      for (let v of inimigos) {
        if (mapa[v.y][v.x] === "V") mapa[v.y][v.x] = " ";
        
        const novaX = v.x + v.dx;
        
       if (novaX <= 0 || novaX >= mapa[0].length - 1 || 
    mapa[v.y][novaX] === "#" || mapa[v.y][novaX] === "." || mapa[v.y][novaX] === "X") {
  v.dx *= -1;
} else {
  v.x = novaX;
}
        
        if (v.x === player.x && v.y === player.y) {
          perderVida("‚ò†Ô∏è Voc√™ foi atingido por um v√≠rus!");
          return;
        }
        
        mapa[v.y][v.x] = "V";
      }
      
      desenharMapa();
    }

    function perderVida(msg) {
      vidas--;
      mostrarCutscene(msg);
      
      if (vidas <= 0) {
        mostrarCutscene("üò≠ Suas vidas acabaram! Reiniciando do come√ßo.");
        faseAtual = 0;
        score = 0;
        vidas = 3;
      }
      
      if (modoDesafio && score > recorde) {
        recorde = score;
        localStorage.setItem("recorde", recorde);
      }
      
      carregarFase(faseAtual);
    }

    window.addEventListener("keydown", (e) => {
      if (menu.style.display === "none" && !jogoPausado) {
        if (e.key === "ArrowUp") mover(0, -1);
        if (e.key === "ArrowDown") mover(0, 1);
        if (e.key === "ArrowLeft") mover(-1, 0);
        if (e.key === "ArrowRight") mover(1, 0);
      }
    });

    document.getElementById("modoHistoriaBtn").addEventListener("click", () => {
      modoDesafio = false;
      menu.style.display = "none";
      hud.style.display = "block";
      canvas.style.display = "block";
      carregarFase(0);
    });

    document.getElementById("modoInfinitoBtn").addEventListener("click", () => {
      modoDesafio = true;
      menu.style.display = "none";
      hud.style.display = "block";
      canvas.style.display = "block";
      carregarFase(0);
    });

    // Inicializa o HUD e canvas como ocultos
    hud.style.display = "none";
    canvas.style.display = "none";
  </script>
</body>
</html>
